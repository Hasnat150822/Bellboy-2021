!function(){function t(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function e(t,e){for(var i=0;i<e.length;i++){var r=e[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}(window.webpackJsonp=window.webpackJsonp||[]).push([[2],{rIor:function(i,r,o){"use strict";o.d(r,"a",function(){return u}),o.d(r,"b",function(){return d});var a=o("fXoL"),s=o("ofXK"),n=o("jhN1"),h=["wrapper"],c=["sourceImage"];function p(t,e){if(1&t){var i=a.Ub();a.Tb(0,"img",4,5),a.dc("load",function(){return a.zc(i),a.fc().imageLoadedInView()}),a.Sb()}if(2&t){var r=a.fc();a.Fc("visibility",r.imageVisible?"visible":"hidden")("transform",r.safeTransformStyle),a.mc("src",r.safeImgDataUrl,a.Bc)}}function g(t,e){if(1&t){var i=a.Ub();a.Rb(0),a.Tb(1,"span",9),a.dc("mousedown",function(t){a.zc(i);var e=a.fc(2);return e.startMove(t,e.moveTypes.Resize,"topleft")})("touchstart",function(t){a.zc(i);var e=a.fc(2);return e.startMove(t,e.moveTypes.Resize,"topleft")}),a.Ob(2,"span",10),a.Sb(),a.Tb(3,"span",11),a.Ob(4,"span",10),a.Sb(),a.Tb(5,"span",12),a.dc("mousedown",function(t){a.zc(i);var e=a.fc(2);return e.startMove(t,e.moveTypes.Resize,"topright")})("touchstart",function(t){a.zc(i);var e=a.fc(2);return e.startMove(t,e.moveTypes.Resize,"topright")}),a.Ob(6,"span",10),a.Sb(),a.Tb(7,"span",13),a.Ob(8,"span",10),a.Sb(),a.Tb(9,"span",14),a.dc("mousedown",function(t){a.zc(i);var e=a.fc(2);return e.startMove(t,e.moveTypes.Resize,"bottomright")})("touchstart",function(t){a.zc(i);var e=a.fc(2);return e.startMove(t,e.moveTypes.Resize,"bottomright")}),a.Ob(10,"span",10),a.Sb(),a.Tb(11,"span",15),a.Ob(12,"span",10),a.Sb(),a.Tb(13,"span",16),a.dc("mousedown",function(t){a.zc(i);var e=a.fc(2);return e.startMove(t,e.moveTypes.Resize,"bottomleft")})("touchstart",function(t){a.zc(i);var e=a.fc(2);return e.startMove(t,e.moveTypes.Resize,"bottomleft")}),a.Ob(14,"span",10),a.Sb(),a.Tb(15,"span",17),a.Ob(16,"span",10),a.Sb(),a.Tb(17,"span",18),a.dc("mousedown",function(t){a.zc(i);var e=a.fc(2);return e.startMove(t,e.moveTypes.Resize,"top")})("touchstart",function(t){a.zc(i);var e=a.fc(2);return e.startMove(t,e.moveTypes.Resize,"top")}),a.Sb(),a.Tb(18,"span",19),a.dc("mousedown",function(t){a.zc(i);var e=a.fc(2);return e.startMove(t,e.moveTypes.Resize,"right")})("touchstart",function(t){a.zc(i);var e=a.fc(2);return e.startMove(t,e.moveTypes.Resize,"right")}),a.Sb(),a.Tb(19,"span",20),a.dc("mousedown",function(t){a.zc(i);var e=a.fc(2);return e.startMove(t,e.moveTypes.Resize,"bottom")})("touchstart",function(t){a.zc(i);var e=a.fc(2);return e.startMove(t,e.moveTypes.Resize,"bottom")}),a.Sb(),a.Tb(20,"span",21),a.dc("mousedown",function(t){a.zc(i);var e=a.fc(2);return e.startMove(t,e.moveTypes.Resize,"left")})("touchstart",function(t){a.zc(i);var e=a.fc(2);return e.startMove(t,e.moveTypes.Resize,"left")}),a.Sb(),a.Qb()}}function m(t,e){if(1&t){var i=a.Ub();a.Tb(0,"div",6),a.dc("keydown",function(t){return a.zc(i),a.fc().keyboardAccess(t)}),a.Tb(1,"div",7),a.dc("mousedown",function(t){a.zc(i);var e=a.fc();return e.startMove(t,e.moveTypes.Move)})("touchstart",function(t){a.zc(i);var e=a.fc();return e.startMove(t,e.moveTypes.Move)}),a.Sb(),a.Gc(2,g,21,0,"ng-container",8),a.Sb()}if(2&t){var r=a.fc();a.Fc("top",r.cropper.y1,"px")("left",r.cropper.x1,"px")("width",r.cropper.x2-r.cropper.x1,"px")("height",r.cropper.y2-r.cropper.y1,"px")("margin-left","center"===r.alignImage?r.marginLeft:null)("visibility",r.imageVisible?"visible":"hidden"),a.Fb("rounded",r.roundCropper),a.Ab(2),a.mc("ngIf",!r.hideResizeSquares)}}var l={Move:"move",Resize:"resize",Pinch:"pinch"},u=function(){var i=function(){function i(e,r){t(this,i),this.sanitizer=e,this.cd=r,this.Hammer="undefined"!=typeof window?window.Hammer:null,this.setImageMaxSizeRetries=0,this.cropperScaledMinWidth=20,this.cropperScaledMinHeight=20,this.exifTransform={rotate:0,flip:!1},this.autoRotateSupported=new Promise(function(t){var e=new Image;e.onload=function(){t(1===e.width&&2===e.height)},e.src="data:image/jpeg;base64,/9j/4QAiRXhpZgAATU0AKgAAAAgAAQESAAMAAAABAAYAAAAAAAD/2wCEAAEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAf/AABEIAAEAAgMBEQACEQEDEQH/xABKAAEAAAAAAAAAAAAAAAAAAAALEAEAAAAAAAAAAAAAAAAAAAAAAQEAAAAAAAAAAAAAAAAAAAAAEQEAAAAAAAAAAAAAAAAAAAAA/9oADAMBAAIRAxEAPwA/8H//2Q=="}),this.stepSize=3,this.marginLeft="0px",this.imageVisible=!1,this.moveTypes=l,this.format="png",this.maintainAspectRatio=!0,this.transform={},this.aspectRatio=1,this.resizeToWidth=0,this.resizeToHeight=0,this.cropperMinWidth=0,this.cropperMinHeight=0,this.cropperStaticWidth=0,this.cropperStaticHeight=0,this.canvasRotation=0,this.initialStepSize=3,this.roundCropper=!1,this.onlyScaleDown=!1,this.imageQuality=92,this.autoCrop=!0,this.containWithinAspectRatio=!1,this.hideResizeSquares=!1,this.cropper={x1:-100,y1:-100,x2:1e4,y2:1e4},this.alignImage="center",this.disabled=!1,this.imageCropped=new a.n,this.startCropImage=new a.n,this.imageLoaded=new a.n,this.cropperReady=new a.n,this.loadImageFailed=new a.n,this.initCropper()}var r,o,s;return r=i,(o=[{key:"ngOnChanges",value:function(t){this.cropperStaticHeight&&this.cropperStaticWidth&&(this.hideResizeSquares=!0,this.cropperMinWidth=this.cropperStaticWidth,this.cropperMinHeight=this.cropperStaticHeight,this.maintainAspectRatio=!1),this.onChangesInputImage(t),this.originalImage&&this.originalImage.complete&&this.exifTransform&&(t.containWithinAspectRatio||t.canvasRotation)&&this.transformOriginalImage(),t.cropper&&(this.setMaxSize(),this.setCropperScaledMinSize(),this.checkCropperPosition(!1),this.doAutoCrop(),this.cd.markForCheck()),t.aspectRatio&&this.imageVisible&&this.resetCropperPosition(),t.transform&&(this.transform=this.transform||{},this.setCssTransform(),this.doAutoCrop())}},{key:"onChangesInputImage",value:function(t){(t.imageChangedEvent||t.imageURL||t.imageBase64||t.imageFile)&&this.initCropper(),t.imageChangedEvent&&this.isValidImageChangedEvent()&&this.loadImageFile(this.imageChangedEvent.target.files[0]),t.imageURL&&this.imageURL&&this.loadImageFromURL(this.imageURL),t.imageBase64&&this.imageBase64&&this.loadBase64Image(this.imageBase64),t.imageFile&&this.imageFile&&this.loadImageFile(this.imageFile)}},{key:"isValidImageChangedEvent",value:function(){return this.imageChangedEvent&&this.imageChangedEvent.target&&this.imageChangedEvent.target.files&&this.imageChangedEvent.target.files.length>0}},{key:"setCssTransform",value:function(){this.safeTransformStyle=this.sanitizer.bypassSecurityTrustStyle("scaleX("+(this.transform.scale||1)*(this.transform.flipH?-1:1)+")scaleY("+(this.transform.scale||1)*(this.transform.flipV?-1:1)+")rotate("+(this.transform.rotate||0)+"deg)")}},{key:"ngOnInit",value:function(){this.stepSize=this.initialStepSize,this.activatePinchGesture()}},{key:"initCropper",value:function(){this.imageVisible=!1,this.transformedImage=null,this.safeImgDataUrl="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=",this.moveStart={active:!1,type:null,position:null,x1:0,y1:0,x2:0,y2:0,clientX:0,clientY:0},this.maxSize={width:0,height:0},this.originalSize={width:0,height:0},this.transformedSize={width:0,height:0},this.cropper.x1=-100,this.cropper.y1=-100,this.cropper.x2=1e4,this.cropper.y2=1e4}},{key:"loadImage",value:function(t,e){this.isValidImageType(e)?this.loadBase64Image(t):this.loadImageFailed.emit()}},{key:"loadImageFile",value:function(t){var e=this,i=new FileReader;i.onload=function(i){return e.loadImage(i.target.result,t.type)},i.readAsDataURL(t)}},{key:"isValidImageType",value:function(t){return/image\/(png|jpg|jpeg|bmp|gif|tiff|webp)/.test(t)}},{key:"loadBase64Image",value:function(t){var e=this;this.autoRotateSupported.then(function(i){return e.checkExifAndLoadBase64Image(t,i)}).then(function(){return e.transformOriginalImage()}).catch(function(t){e.loadImageFailed.emit(),e.originalImage=null,e.originalBase64=null,console.error(t)})}},{key:"checkExifAndLoadBase64Image",value:function(t,e){var i=this;return new Promise(function(r,o){i.originalImage=new Image,i.originalImage.onload=function(){i.originalBase64=t,i.exifTransform=function(t){switch("string"==typeof t&&(t=function(t){var e=new DataView(function(t){t=t.replace(/^data\:([^\;]+)\;base64,/gim,"");for(var e=atob(t),i=e.length,r=new Uint8Array(i),o=0;o<i;o++)r[o]=e.charCodeAt(o);return r.buffer}(t));if(65496!=e.getUint16(0,!1))return-2;for(var i=e.byteLength,r=2;r<i;){if(e.getUint16(r+2,!1)<=8)return-1;var o=e.getUint16(r,!1);if(r+=2,65505==o){if(1165519206!=e.getUint32(r+=2,!1))return-1;var a=18761==e.getUint16(r+=6,!1);r+=e.getUint32(r+4,a);var s=e.getUint16(r,a);r+=2;for(var n=0;n<s;n++)if(274==e.getUint16(r+12*n,a))return e.getUint16(r+12*n+8,a)}else{if(65280!=(65280&o))break;r+=e.getUint16(r,!1)}}return-1}(t)),t){case 2:return{rotate:0,flip:!0};case 3:return{rotate:2,flip:!1};case 4:return{rotate:2,flip:!0};case 5:return{rotate:1,flip:!0};case 6:return{rotate:1,flip:!1};case 7:return{rotate:3,flip:!0};case 8:return{rotate:3,flip:!1};default:return{rotate:0,flip:!1}}}(e?-1:t),i.originalSize.width=i.originalImage.naturalWidth,i.originalSize.height=i.originalImage.naturalHeight,r()},i.originalImage.onerror=o,i.originalImage.src=t})}},{key:"loadImageFromURL",value:function(t){var e=this,i=new Image;i.onerror=function(){return e.loadImageFailed.emit()},i.onload=function(){var t=document.createElement("canvas"),r=t.getContext("2d");t.width=i.width,t.height=i.height,r.drawImage(i,0,0),e.loadBase64Image(t.toDataURL())},i.crossOrigin="anonymous",i.src=t}},{key:"transformOriginalImage",value:function(){if(!this.originalImage||!this.originalImage.complete||!this.exifTransform)return Promise.reject(new Error("No image loaded"));var t=this.transformImageBase64();return this.setTransformedImage(t)}},{key:"transformImageBase64",value:function(){var t=this.canvasRotation+this.exifTransform.rotate;if(0===t&&!this.exifTransform.flip&&!this.containWithinAspectRatio)return this.originalBase64;var e=this.getTransformedSize(),i=document.createElement("canvas");i.width=e.width,i.height=e.height;var r=i.getContext("2d");return r.setTransform(this.exifTransform.flip?-1:1,0,0,1,i.width/2,i.height/2),r.rotate(Math.PI*(t/2)),r.drawImage(this.originalImage,-this.originalSize.width/2,-this.originalSize.height/2),i.toDataURL()}},{key:"getTransformedSize",value:function(){var t=this.canvasRotation+this.exifTransform.rotate;if(this.containWithinAspectRatio){if(t%2){var e=this.originalSize.height/this.aspectRatio;return{width:Math.max(this.originalSize.height,this.originalSize.width*this.aspectRatio),height:Math.max(this.originalSize.width,e)}}var i=this.originalSize.width/this.aspectRatio;return{width:Math.max(this.originalSize.width,this.originalSize.height*this.aspectRatio),height:Math.max(this.originalSize.height,i)}}return t%2?{height:this.originalSize.width,width:this.originalSize.height}:{width:this.originalSize.width,height:this.originalSize.height}}},{key:"setTransformedImage",value:function(t){var e=this;return new Promise(function(i){e.transformedBase64=t,e.safeImgDataUrl=e.sanitizer.bypassSecurityTrustResourceUrl(t),e.transformedImage=new Image,e.transformedImage.onload=function(){e.transformedSize.width=e.transformedImage.naturalWidth,e.transformedSize.height=e.transformedImage.naturalHeight,e.cd.markForCheck(),i()},e.transformedImage.src=e.transformedBase64})}},{key:"imageLoadedInView",value:function(){var t=this;null!=this.transformedImage&&(this.imageLoaded.emit(),this.setImageMaxSizeRetries=0,setTimeout(function(){return t.checkImageMaxSizeRecursively()}))}},{key:"checkImageMaxSizeRecursively",value:function(){var t=this;this.setImageMaxSizeRetries>40?this.loadImageFailed.emit():this.sourceImageLoaded()?(this.setMaxSize(),this.setCropperScaledMinSize(),this.resetCropperPosition(),this.cropperReady.emit(Object.assign({},this.maxSize)),this.cd.markForCheck()):(this.setImageMaxSizeRetries++,setTimeout(function(){return t.checkImageMaxSizeRecursively()},50))}},{key:"sourceImageLoaded",value:function(){return this.sourceImage&&this.sourceImage.nativeElement&&this.sourceImage.nativeElement.offsetWidth>0}},{key:"onResize",value:function(){this.resizeCropperPosition(),this.setMaxSize(),this.setCropperScaledMinSize()}},{key:"activatePinchGesture",value:function(){if(this.Hammer){var t=new this.Hammer(this.wrapper.nativeElement);t.get("pinch").set({enable:!0}),t.on("pinchmove",this.onPinch.bind(this)),t.on("pinchend",this.pinchStop.bind(this)),t.on("pinchstart",this.startPinch.bind(this))}else Object(a.W)()&&console.warn("[NgxImageCropper] Could not find HammerJS - Pinch Gesture won't work")}},{key:"resizeCropperPosition",value:function(){var t=this.sourceImage.nativeElement;this.maxSize.width===t.offsetWidth&&this.maxSize.height===t.offsetHeight||(this.cropper.x1=this.cropper.x1*t.offsetWidth/this.maxSize.width,this.cropper.x2=this.cropper.x2*t.offsetWidth/this.maxSize.width,this.cropper.y1=this.cropper.y1*t.offsetHeight/this.maxSize.height,this.cropper.y2=this.cropper.y2*t.offsetHeight/this.maxSize.height)}},{key:"resetCropperPosition",value:function(){var t=this.sourceImage.nativeElement;if(this.cropperStaticHeight&&this.cropperStaticWidth)this.cropper.x1=0,this.cropper.x2=t.offsetWidth>this.cropperStaticWidth?this.cropperStaticWidth:t.offsetWidth,this.cropper.y1=0,this.cropper.y2=t.offsetHeight>this.cropperStaticHeight?this.cropperStaticHeight:t.offsetHeight;else if(this.maintainAspectRatio)if(t.offsetWidth/this.aspectRatio<t.offsetHeight){this.cropper.x1=0,this.cropper.x2=t.offsetWidth;var e=t.offsetWidth/this.aspectRatio;this.cropper.y1=(t.offsetHeight-e)/2,this.cropper.y2=this.cropper.y1+e}else{this.cropper.y1=0,this.cropper.y2=t.offsetHeight;var i=t.offsetHeight*this.aspectRatio;this.cropper.x1=(t.offsetWidth-i)/2,this.cropper.x2=this.cropper.x1+i}else this.cropper.x1=0,this.cropper.x2=t.offsetWidth,this.cropper.y1=0,this.cropper.y2=t.offsetHeight;this.doAutoCrop(),this.imageVisible=!0}},{key:"keyboardAccess",value:function(t){this.changeKeyboardStepSize(t),this.keyboardMoveCropper(t)}},{key:"changeKeyboardStepSize",value:function(t){t.key>="1"&&t.key<="9"&&(this.stepSize=+t.key)}},{key:"keyboardMoveCropper",value:function(t){if(["ArrowUp","ArrowDown","ArrowRight","ArrowLeft"].includes(t.key)){var e=t.shiftKey?l.Resize:l.Move,i=t.altKey?this.getInvertedPositionForKey(t.key):this.getPositionForKey(t.key),r=this.getEventForKey(t.key,this.stepSize);t.preventDefault(),t.stopPropagation(),this.startMove({clientX:0,clientY:0},e,i),this.moveImg(r),this.moveStop()}}},{key:"getPositionForKey",value:function(t){switch(t){case"ArrowUp":return"top";case"ArrowRight":return"right";case"ArrowDown":return"bottom";case"ArrowLeft":default:return"left"}}},{key:"getInvertedPositionForKey",value:function(t){switch(t){case"ArrowUp":return"bottom";case"ArrowRight":return"left";case"ArrowDown":return"top";case"ArrowLeft":default:return"right"}}},{key:"getEventForKey",value:function(t,e){switch(t){case"ArrowUp":return{clientX:0,clientY:-1*e};case"ArrowRight":return{clientX:e,clientY:0};case"ArrowDown":return{clientX:0,clientY:e};case"ArrowLeft":default:return{clientX:-1*e,clientY:0}}}},{key:"startMove",value:function(t,e){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;this.moveStart&&this.moveStart.active&&this.moveStart.type===l.Pinch||(t.preventDefault&&t.preventDefault(),this.moveStart=Object.assign({active:!0,type:e,position:i,clientX:this.getClientX(t),clientY:this.getClientY(t)},this.cropper))}},{key:"startPinch",value:function(t){this.safeImgDataUrl&&(t.preventDefault&&t.preventDefault(),this.moveStart=Object.assign({active:!0,type:l.Pinch,position:"center",clientX:this.cropper.x1+(this.cropper.x2-this.cropper.x1)/2,clientY:this.cropper.y1+(this.cropper.y2-this.cropper.y1)/2},this.cropper))}},{key:"moveImg",value:function(t){this.moveStart.active&&(t.stopPropagation&&t.stopPropagation(),t.preventDefault&&t.preventDefault(),this.moveStart.type===l.Move?(this.move(t),this.checkCropperPosition(!0)):this.moveStart.type===l.Resize&&(this.cropperStaticWidth||this.cropperStaticHeight||this.resize(t),this.checkCropperPosition(!1)),this.cd.detectChanges())}},{key:"onPinch",value:function(t){this.moveStart.active&&(t.stopPropagation&&t.stopPropagation(),t.preventDefault&&t.preventDefault(),this.moveStart.type===l.Pinch&&(this.resize(t),this.checkCropperPosition(!1)),this.cd.detectChanges())}},{key:"setMaxSize",value:function(){if(this.sourceImage){var t=this.sourceImage.nativeElement;this.maxSize.width=t.offsetWidth,this.maxSize.height=t.offsetHeight,this.marginLeft=this.sanitizer.bypassSecurityTrustStyle("calc(50% - "+this.maxSize.width/2+"px)")}}},{key:"setCropperScaledMinSize",value:function(){this.transformedImage?(this.setCropperScaledMinWidth(),this.setCropperScaledMinHeight()):(this.cropperScaledMinWidth=20,this.cropperScaledMinHeight=20)}},{key:"setCropperScaledMinWidth",value:function(){this.cropperScaledMinWidth=this.cropperMinWidth>0?Math.max(20,this.cropperMinWidth/this.transformedImage.width*this.maxSize.width):20}},{key:"setCropperScaledMinHeight",value:function(){this.cropperScaledMinHeight=this.maintainAspectRatio?Math.max(20,this.cropperScaledMinWidth/this.aspectRatio):this.cropperMinHeight>0?Math.max(20,this.cropperMinHeight/this.transformedImage.height*this.maxSize.height):20}},{key:"checkCropperPosition",value:function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.cropper.x1<0&&(this.cropper.x2-=t?this.cropper.x1:0,this.cropper.x1=0),this.cropper.y1<0&&(this.cropper.y2-=t?this.cropper.y1:0,this.cropper.y1=0),this.cropper.x2>this.maxSize.width&&(this.cropper.x1-=t?this.cropper.x2-this.maxSize.width:0,this.cropper.x2=this.maxSize.width),this.cropper.y2>this.maxSize.height&&(this.cropper.y1-=t?this.cropper.y2-this.maxSize.height:0,this.cropper.y2=this.maxSize.height)}},{key:"moveStop",value:function(){this.moveStart.active&&(this.moveStart.active=!1,this.doAutoCrop())}},{key:"pinchStop",value:function(){this.moveStart.active&&(this.moveStart.active=!1,this.doAutoCrop())}},{key:"move",value:function(t){var e=this.getClientX(t)-this.moveStart.clientX,i=this.getClientY(t)-this.moveStart.clientY;this.cropper.x1=this.moveStart.x1+e,this.cropper.y1=this.moveStart.y1+i,this.cropper.x2=this.moveStart.x2+e,this.cropper.y2=this.moveStart.y2+i}},{key:"resize",value:function(t){var e=this.getClientX(t)-this.moveStart.clientX,i=this.getClientY(t)-this.moveStart.clientY;switch(this.moveStart.position){case"left":this.cropper.x1=Math.min(this.moveStart.x1+e,this.cropper.x2-this.cropperScaledMinWidth);break;case"topleft":this.cropper.x1=Math.min(this.moveStart.x1+e,this.cropper.x2-this.cropperScaledMinWidth),this.cropper.y1=Math.min(this.moveStart.y1+i,this.cropper.y2-this.cropperScaledMinHeight);break;case"top":this.cropper.y1=Math.min(this.moveStart.y1+i,this.cropper.y2-this.cropperScaledMinHeight);break;case"topright":this.cropper.x2=Math.max(this.moveStart.x2+e,this.cropper.x1+this.cropperScaledMinWidth),this.cropper.y1=Math.min(this.moveStart.y1+i,this.cropper.y2-this.cropperScaledMinHeight);break;case"right":this.cropper.x2=Math.max(this.moveStart.x2+e,this.cropper.x1+this.cropperScaledMinWidth);break;case"bottomright":this.cropper.x2=Math.max(this.moveStart.x2+e,this.cropper.x1+this.cropperScaledMinWidth),this.cropper.y2=Math.max(this.moveStart.y2+i,this.cropper.y1+this.cropperScaledMinHeight);break;case"bottom":this.cropper.y2=Math.max(this.moveStart.y2+i,this.cropper.y1+this.cropperScaledMinHeight);break;case"bottomleft":this.cropper.x1=Math.min(this.moveStart.x1+e,this.cropper.x2-this.cropperScaledMinWidth),this.cropper.y2=Math.max(this.moveStart.y2+i,this.cropper.y1+this.cropperScaledMinHeight);break;case"center":var r=t.scale,o=Math.abs(this.moveStart.x2-this.moveStart.x1)*r,a=Math.abs(this.moveStart.y2-this.moveStart.y1)*r,s=this.cropper.x1,n=this.cropper.y1;this.cropper.x1=Math.min(this.moveStart.clientX-o/2,this.cropper.x2-this.cropperScaledMinWidth),this.cropper.y1=Math.min(this.moveStart.clientY-a/2,this.cropper.y2-this.cropperScaledMinHeight),this.cropper.x2=Math.max(this.moveStart.clientX+o/2,s+this.cropperScaledMinWidth),this.cropper.y2=Math.max(this.moveStart.clientY+a/2,n+this.cropperScaledMinHeight)}this.maintainAspectRatio&&this.checkAspectRatio()}},{key:"checkAspectRatio",value:function(){var t=0,e=0;switch(this.moveStart.position){case"top":this.cropper.x2=this.cropper.x1+(this.cropper.y2-this.cropper.y1)*this.aspectRatio,t=Math.max(this.cropper.x2-this.maxSize.width,0),e=Math.max(0-this.cropper.y1,0),(t>0||e>0)&&(this.cropper.x2-=e*this.aspectRatio>t?e*this.aspectRatio:t,this.cropper.y1+=e*this.aspectRatio>t?e:t/this.aspectRatio);break;case"bottom":this.cropper.x2=this.cropper.x1+(this.cropper.y2-this.cropper.y1)*this.aspectRatio,t=Math.max(this.cropper.x2-this.maxSize.width,0),e=Math.max(this.cropper.y2-this.maxSize.height,0),(t>0||e>0)&&(this.cropper.x2-=e*this.aspectRatio>t?e*this.aspectRatio:t,this.cropper.y2-=e*this.aspectRatio>t?e:t/this.aspectRatio);break;case"topleft":this.cropper.y1=this.cropper.y2-(this.cropper.x2-this.cropper.x1)/this.aspectRatio,t=Math.max(0-this.cropper.x1,0),e=Math.max(0-this.cropper.y1,0),(t>0||e>0)&&(this.cropper.x1+=e*this.aspectRatio>t?e*this.aspectRatio:t,this.cropper.y1+=e*this.aspectRatio>t?e:t/this.aspectRatio);break;case"topright":this.cropper.y1=this.cropper.y2-(this.cropper.x2-this.cropper.x1)/this.aspectRatio,t=Math.max(this.cropper.x2-this.maxSize.width,0),e=Math.max(0-this.cropper.y1,0),(t>0||e>0)&&(this.cropper.x2-=e*this.aspectRatio>t?e*this.aspectRatio:t,this.cropper.y1+=e*this.aspectRatio>t?e:t/this.aspectRatio);break;case"right":case"bottomright":this.cropper.y2=this.cropper.y1+(this.cropper.x2-this.cropper.x1)/this.aspectRatio,t=Math.max(this.cropper.x2-this.maxSize.width,0),e=Math.max(this.cropper.y2-this.maxSize.height,0),(t>0||e>0)&&(this.cropper.x2-=e*this.aspectRatio>t?e*this.aspectRatio:t,this.cropper.y2-=e*this.aspectRatio>t?e:t/this.aspectRatio);break;case"left":case"bottomleft":this.cropper.y2=this.cropper.y1+(this.cropper.x2-this.cropper.x1)/this.aspectRatio,t=Math.max(0-this.cropper.x1,0),e=Math.max(this.cropper.y2-this.maxSize.height,0),(t>0||e>0)&&(this.cropper.x1+=e*this.aspectRatio>t?e*this.aspectRatio:t,this.cropper.y2-=e*this.aspectRatio>t?e:t/this.aspectRatio);break;case"center":this.cropper.x2=this.cropper.x1+(this.cropper.y2-this.cropper.y1)*this.aspectRatio,this.cropper.y2=this.cropper.y1+(this.cropper.x2-this.cropper.x1)/this.aspectRatio;var i=Math.max(0-this.cropper.x1,0),r=Math.max(this.cropper.x2-this.maxSize.width,0),o=Math.max(this.cropper.y2-this.maxSize.height,0),a=Math.max(0-this.cropper.y1,0);(i>0||r>0||o>0||a>0)&&(this.cropper.x1+=o*this.aspectRatio>i?o*this.aspectRatio:i,this.cropper.x2-=a*this.aspectRatio>r?a*this.aspectRatio:r,this.cropper.y1+=a*this.aspectRatio>r?a:r/this.aspectRatio,this.cropper.y2-=o*this.aspectRatio>i?o:i/this.aspectRatio)}}},{key:"doAutoCrop",value:function(){this.autoCrop&&this.crop()}},{key:"crop",value:function(){if(this.sourceImage&&this.sourceImage.nativeElement&&null!=this.transformedImage){this.startCropImage.emit();var t=this.getImagePosition(),e=t.x2-t.x1,i=t.y2-t.y1,r=document.createElement("canvas");r.width=e,r.height=i;var o=r.getContext("2d");if(o){null!=this.backgroundColor&&(o.fillStyle=this.backgroundColor,o.fillRect(0,0,e,i));var a=(this.transform.scale||1)*(this.transform.flipH?-1:1),s=(this.transform.scale||1)*(this.transform.flipV?-1:1);o.setTransform(a,0,0,s,this.transformedSize.width/2,this.transformedSize.height/2),o.translate(-t.x1/a,-t.y1/s),o.rotate((this.transform.rotate||0)*Math.PI/180),o.drawImage(this.transformedImage,-this.transformedSize.width/2,-this.transformedSize.height/2);var n={width:e,height:i,imagePosition:t,cropperPosition:Object.assign({},this.cropper)};this.containWithinAspectRatio&&(n.offsetImagePosition=this.getOffsetImagePosition());var h=this.getResizeRatio(e,i);return 1!==h&&(n.width=Math.round(e*h),n.height=this.maintainAspectRatio?Math.round(n.width/this.aspectRatio):Math.round(i*h),function(t,e,i){var r=t.width,o=t.height,a=r/(e=Math.round(e)),s=o/(i=Math.round(i)),n=Math.ceil(a/2),h=Math.ceil(s/2),c=t.getContext("2d");if(c){for(var p=c.getImageData(0,0,r,o),g=c.createImageData(e,i),m=p.data,l=g.data,u=0;u<i;u++)for(var d=0;d<e;d++){var f=4*(d+u*e),v=u*s,x=0,y=0,A=0,M=0,S=0,b=0,z=0,w=Math.floor(d*a),C=Math.floor(u*s),R=Math.ceil((d+1)*a),I=Math.ceil((u+1)*s);R=Math.min(R,r),I=Math.min(I,o);for(var P=C;P<I;P++)for(var k=Math.abs(v-P)/h,O=d*a,E=k*k,_=w;_<R;_++){var T=Math.abs(O-_)/n,B=Math.sqrt(E+T*T);if(!(B>=1)){var Q=4*(_+P*r);z+=(x=2*B*B*B-3*B*B+1)*m[Q+3],A+=x,m[Q+3]<255&&(x=x*m[Q+3]/250),M+=x*m[Q],S+=x*m[Q+1],b+=x*m[Q+2],y+=x}}l[f]=M/y,l[f+1]=S/y,l[f+2]=b/y,l[f+3]=z/A}t.width=e,t.height=i,c.putImageData(g,0,0)}}(r,n.width,n.height)),n.base64=this.cropToBase64(r),this.imageCropped.emit(n),n}}return null}},{key:"getImagePosition",value:function(){var t=this.transformedSize.width/this.sourceImage.nativeElement.offsetWidth,e={x1:Math.round(this.cropper.x1*t),y1:Math.round(this.cropper.y1*t),x2:Math.round(this.cropper.x2*t),y2:Math.round(this.cropper.y2*t)};return this.containWithinAspectRatio||(e.x1=Math.max(e.x1,0),e.y1=Math.max(e.y1,0),e.x2=Math.min(e.x2,this.transformedSize.width),e.y2=Math.min(e.y2,this.transformedSize.height)),e}},{key:"getOffsetImagePosition",value:function(){var t,e,i=this.transformedSize.width/this.sourceImage.nativeElement.offsetWidth;(this.canvasRotation+this.exifTransform.rotate)%2?(t=(this.transformedSize.width-this.originalSize.height)/2,e=(this.transformedSize.height-this.originalSize.width)/2):(t=(this.transformedSize.width-this.originalSize.width)/2,e=(this.transformedSize.height-this.originalSize.height)/2);var r={x1:Math.round(this.cropper.x1*i)-t,y1:Math.round(this.cropper.y1*i)-e,x2:Math.round(this.cropper.x2*i)-t,y2:Math.round(this.cropper.y2*i)-e};return this.containWithinAspectRatio||(r.x1=Math.max(r.x1,0),r.y1=Math.max(r.y1,0),r.x2=Math.min(r.x2,this.transformedSize.width),r.y2=Math.min(r.y2,this.transformedSize.height)),r}},{key:"cropToBase64",value:function(t){return t.toDataURL("image/"+this.format,this.getQuality())}},{key:"getQuality",value:function(){return Math.min(1,Math.max(0,this.imageQuality/100))}},{key:"getResizeRatio",value:function(t,e){var i=this.resizeToWidth/t,r=this.resizeToHeight/e,o=new Array;this.resizeToWidth>0&&o.push(i),this.resizeToHeight>0&&o.push(r);var a=0===o.length?1:Math.min.apply(Math,o);return a>1&&!this.onlyScaleDown?a:Math.min(a,1)}},{key:"getClientX",value:function(t){return(t.touches&&t.touches[0]?t.touches[0].clientX:t.clientX)||0}},{key:"getClientY",value:function(t){return(t.touches&&t.touches[0]?t.touches[0].clientY:t.clientY)||0}}])&&e(r.prototype,o),s&&e(r,s),i}();return i.\u0275fac=function(t){return new(t||i)(a.Nb(n.b),a.Nb(a.h))},i.\u0275cmp=a.Hb({type:i,selectors:[["image-cropper"]],viewQuery:function(t,e){var i;(1&t&&(a.Ec(h,!0),a.Nc(c,!0)),2&t)&&(a.vc(i=a.ec())&&(e.wrapper=i.first),a.vc(i=a.ec())&&(e.sourceImage=i.first))},hostVars:4,hostBindings:function(t,e){1&t&&a.dc("resize",function(){return e.onResize()},!1,a.yc)("mousemove",function(t){return e.moveImg(t)},!1,a.xc)("touchmove",function(t){return e.moveImg(t)},!1,a.xc)("mouseup",function(){return e.moveStop()},!1,a.xc)("touchend",function(){return e.moveStop()},!1,a.xc),2&t&&(a.Fc("text-align",e.alignImage),a.Fb("disabled",e.disabled))},inputs:{format:"format",maintainAspectRatio:"maintainAspectRatio",transform:"transform",aspectRatio:"aspectRatio",resizeToWidth:"resizeToWidth",resizeToHeight:"resizeToHeight",cropperMinWidth:"cropperMinWidth",cropperMinHeight:"cropperMinHeight",cropperStaticWidth:"cropperStaticWidth",cropperStaticHeight:"cropperStaticHeight",canvasRotation:"canvasRotation",initialStepSize:"initialStepSize",roundCropper:"roundCropper",onlyScaleDown:"onlyScaleDown",imageQuality:"imageQuality",autoCrop:"autoCrop",containWithinAspectRatio:"containWithinAspectRatio",hideResizeSquares:"hideResizeSquares",cropper:"cropper",alignImage:"alignImage",disabled:"disabled",imageChangedEvent:"imageChangedEvent",imageURL:"imageURL",imageBase64:"imageBase64",imageFile:"imageFile",backgroundColor:"backgroundColor"},outputs:{imageCropped:"imageCropped",startCropImage:"startCropImage",imageLoaded:"imageLoaded",cropperReady:"cropperReady",loadImageFailed:"loadImageFailed"},features:[a.yb],decls:5,vars:10,consts:[["wrapper",""],["class","source-image",3,"src","visibility","transform","load",4,"ngIf"],[1,"overlay"],["class","cropper","tabindex","0",3,"rounded","top","left","width","height","margin-left","visibility","keydown",4,"ngIf"],[1,"source-image",3,"src","load"],["sourceImage",""],["tabindex","0",1,"cropper",3,"keydown"],[1,"move",3,"mousedown","touchstart"],[4,"ngIf"],[1,"resize","topleft",3,"mousedown","touchstart"],[1,"square"],[1,"resize","top"],[1,"resize","topright",3,"mousedown","touchstart"],[1,"resize","right"],[1,"resize","bottomright",3,"mousedown","touchstart"],[1,"resize","bottom"],[1,"resize","bottomleft",3,"mousedown","touchstart"],[1,"resize","left"],[1,"resize-bar","top",3,"mousedown","touchstart"],[1,"resize-bar","right",3,"mousedown","touchstart"],[1,"resize-bar","bottom",3,"mousedown","touchstart"],[1,"resize-bar","left",3,"mousedown","touchstart"]],template:function(t,e){1&t&&(a.Tb(0,"div",null,0),a.Gc(2,p,2,5,"img",1),a.Ob(3,"div",2),a.Gc(4,m,3,15,"div",3),a.Sb()),2&t&&(a.Fc("background",e.imageVisible&&e.backgroundColor),a.Ab(2),a.mc("ngIf",e.safeImgDataUrl),a.Ab(1),a.Fc("width",e.maxSize.width,"px")("height",e.maxSize.height,"px")("margin-left","center"===e.alignImage?e.marginLeft:null),a.Ab(1),a.mc("ngIf",e.imageVisible))},directives:[s.o],styles:['[_nghost-%COMP%]{display:flex;position:relative;width:100%;max-width:100%;max-height:100%;overflow:hidden;padding:5px;text-align:center}[_nghost-%COMP%] > div[_ngcontent-%COMP%]{width:100%;position:relative}[_nghost-%COMP%] > div[_ngcontent-%COMP%]   img.source-image[_ngcontent-%COMP%]{max-width:100%;max-height:100%;transform-origin:center}[_nghost-%COMP%]   .overlay[_ngcontent-%COMP%]{position:absolute;pointer-events:none;touch-action:none;outline:var(--cropper-overlay-color,#fff) solid 100vw;top:0;left:0}[_nghost-%COMP%]   .cropper[_ngcontent-%COMP%]{position:absolute;display:flex;color:#53535c;background:0 0;outline:rgba(255,255,255,.3) solid 100vw;outline:var(--cropper-outline-color,rgba(255,255,255,.3)) solid 100vw;touch-action:none}[_nghost-%COMP%]   .cropper[_ngcontent-%COMP%]:after{position:absolute;content:"";top:0;bottom:0;left:0;right:0;pointer-events:none;border:1px dashed;opacity:.75;color:inherit;z-index:1}[_nghost-%COMP%]   .cropper[_ngcontent-%COMP%]   .move[_ngcontent-%COMP%]{width:100%;cursor:move;border:1px solid rgba(255,255,255,.5)}[_nghost-%COMP%]   .cropper[_ngcontent-%COMP%]:focus   .move[_ngcontent-%COMP%]{border-color:#1e90ff;border-width:2px}[_nghost-%COMP%]   .cropper[_ngcontent-%COMP%]   .resize[_ngcontent-%COMP%]{position:absolute;display:inline-block;line-height:6px;padding:8px;opacity:.85;z-index:1}[_nghost-%COMP%]   .cropper[_ngcontent-%COMP%]   .resize[_ngcontent-%COMP%]   .square[_ngcontent-%COMP%]{display:inline-block;background:#53535c;width:6px;height:6px;border:1px solid rgba(255,255,255,.5);box-sizing:content-box}[_nghost-%COMP%]   .cropper[_ngcontent-%COMP%]   .resize.topleft[_ngcontent-%COMP%]{top:-12px;left:-12px;cursor:nwse-resize}[_nghost-%COMP%]   .cropper[_ngcontent-%COMP%]   .resize.top[_ngcontent-%COMP%]{top:-12px;left:calc(50% - 12px);cursor:ns-resize}[_nghost-%COMP%]   .cropper[_ngcontent-%COMP%]   .resize.topright[_ngcontent-%COMP%]{top:-12px;right:-12px;cursor:nesw-resize}[_nghost-%COMP%]   .cropper[_ngcontent-%COMP%]   .resize.right[_ngcontent-%COMP%]{top:calc(50% - 12px);right:-12px;cursor:ew-resize}[_nghost-%COMP%]   .cropper[_ngcontent-%COMP%]   .resize.bottomright[_ngcontent-%COMP%]{bottom:-12px;right:-12px;cursor:nwse-resize}[_nghost-%COMP%]   .cropper[_ngcontent-%COMP%]   .resize.bottom[_ngcontent-%COMP%]{bottom:-12px;left:calc(50% - 12px);cursor:ns-resize}[_nghost-%COMP%]   .cropper[_ngcontent-%COMP%]   .resize.bottomleft[_ngcontent-%COMP%]{bottom:-12px;left:-12px;cursor:nesw-resize}[_nghost-%COMP%]   .cropper[_ngcontent-%COMP%]   .resize.left[_ngcontent-%COMP%]{top:calc(50% - 12px);left:-12px;cursor:ew-resize}[_nghost-%COMP%]   .cropper[_ngcontent-%COMP%]   .resize-bar[_ngcontent-%COMP%]{position:absolute;z-index:1}[_nghost-%COMP%]   .cropper[_ngcontent-%COMP%]   .resize-bar.top[_ngcontent-%COMP%]{top:-11px;left:11px;width:calc(100% - 22px);height:22px;cursor:ns-resize}[_nghost-%COMP%]   .cropper[_ngcontent-%COMP%]   .resize-bar.right[_ngcontent-%COMP%]{top:11px;right:-11px;height:calc(100% - 22px);width:22px;cursor:ew-resize}[_nghost-%COMP%]   .cropper[_ngcontent-%COMP%]   .resize-bar.bottom[_ngcontent-%COMP%]{bottom:-11px;left:11px;width:calc(100% - 22px);height:22px;cursor:ns-resize}[_nghost-%COMP%]   .cropper[_ngcontent-%COMP%]   .resize-bar.left[_ngcontent-%COMP%]{top:11px;left:-11px;height:calc(100% - 22px);width:22px;cursor:ew-resize}[_nghost-%COMP%]   .cropper.rounded[_ngcontent-%COMP%]{outline-color:transparent}[_nghost-%COMP%]   .cropper.rounded[_ngcontent-%COMP%]:after{border-radius:100%;box-shadow:0 0 0 100vw rgba(255,255,255,.3);box-shadow:0 0 0 100vw var(--cropper-outline-color,rgba(255,255,255,.3))}@media (orientation:portrait){[_nghost-%COMP%]   .cropper[_ngcontent-%COMP%]{outline-width:100vh}[_nghost-%COMP%]   .cropper.rounded[_ngcontent-%COMP%]:after{box-shadow:0 0 0 100vh rgba(255,255,255,.3);box-shadow:0 0 0 100vh var(--cropper-outline-color,rgba(255,255,255,.3))}}[_nghost-%COMP%]   .cropper.rounded[_ngcontent-%COMP%]   .move[_ngcontent-%COMP%]{border-radius:100%}.disabled[_nghost-%COMP%]   .cropper[_ngcontent-%COMP%]   .move[_ngcontent-%COMP%], .disabled[_nghost-%COMP%]   .cropper[_ngcontent-%COMP%]   .resize[_ngcontent-%COMP%], .disabled[_nghost-%COMP%]   .cropper[_ngcontent-%COMP%]   .resize-bar[_ngcontent-%COMP%]{display:none}'],changeDetection:0}),i}(),d=function(){var e=function e(){t(this,e)};return e.\u0275mod=a.Lb({type:e}),e.\u0275inj=a.Kb({factory:function(t){return new(t||e)},imports:[[s.c]]}),e}()}}])}();